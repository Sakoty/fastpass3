<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ファストパス設定</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; text-align: center; background-color: #f4f4f4; }
    input, button { margin: 1em 0; padding: 0.6em; width: 80%; font-size: 1em; }
  </style>
</head>
<body>
  <h1>⚙️ ファストパス設定</h1>

  <h3>🎫 特別発券</h3>
  <input type="text" id="manualId" placeholder="例: FP999" />
  <input type="text" id="manualName" placeholder="名前" />
  <input type="number" id="manualCount" placeholder="人数" min="1" />
  <input type="text" id="manualTime" placeholder="案内時間 (例: 13:00)" />
  <button onclick="issueSpecial()">特別発券</button>

  <hr>

  <h3>🗑️ 全削除</h3>
  <button onclick="resetAll()">全削除</button>

  <div id="result"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDibHDpFtKBSCScK0QmB5xjKdBniS2EI1Y",
      authDomain: "fastpass-system.firebaseapp.com",
      projectId: "fastpass-system"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function issueSpecial() {
      const id = document.getElementById("manualId").value.trim();
      const name = document.getElementById("manualName").value.trim();
      const count = parseInt(document.getElementById("manualCount").value);
      const time = document.getElementById("manualTime").value.trim();

      if (!/^FP\d{3}$/.test(id) || !name || isNaN(count) || !time) {
        alert("正しく入力してください");
        return;
      }

      await db.collection("fastpasses").doc(id).set({
        name, count, estimateTime: time, status: "未使用", createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("result").innerText = `${id} を特別発券しました`;
    }

    async function resetAll() {
      if (!confirm("全て削除しますか？")) return;
      const snapshot = await db.collection("fastpasses").get();
      const batch = db.batch();
      snapshot.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
      document.getElementById("result").innerText = "✅ 全て削除しました";
    }
  </script>
</body>
</html>
