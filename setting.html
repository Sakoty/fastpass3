<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãƒ•ã‚¡ã‚¹ãƒˆãƒ‘ã‚¹è¨­å®š</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; text-align: center; background-color: #f4f4f4; }
    input, button { margin: 1em 0; padding: 0.6em; width: 80%; font-size: 1em; }
  </style>
</head>
<body>
  <h1>âš™ï¸ ãƒ•ã‚¡ã‚¹ãƒˆãƒ‘ã‚¹è¨­å®š</h1>

  <h3>ğŸ« ç‰¹åˆ¥ç™ºåˆ¸</h3>
  <input type="text" id="manualId" placeholder="ä¾‹: FP999" />
  <input type="text" id="manualName" placeholder="åå‰" />
  <input type="number" id="manualCount" placeholder="äººæ•°" min="1" />
  <input type="text" id="manualTime" placeholder="æ¡ˆå†…æ™‚é–“ (ä¾‹: 13:00)" />
  <button onclick="issueSpecial()">ç‰¹åˆ¥ç™ºåˆ¸</button>

  <hr>

  <h3>ğŸ—‘ï¸ å…¨å‰Šé™¤</h3>
  <button onclick="resetAll()">å…¨å‰Šé™¤</button>

  <div id="result"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDibHDpFtKBSCScK0QmB5xjKdBniS2EI1Y",
      authDomain: "fastpass-system.firebaseapp.com",
      projectId: "fastpass-system"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function issueSpecial() {
      const id = document.getElementById("manualId").value.trim();
      const name = document.getElementById("manualName").value.trim();
      const count = parseInt(document.getElementById("manualCount").value);
      const time = document.getElementById("manualTime").value.trim();

      if (!/^FP\d{3}$/.test(id) || !name || isNaN(count) || !time) {
        alert("æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      await db.collection("fastpasses").doc(id).set({
        name, count, estimateTime: time, status: "æœªä½¿ç”¨", createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("result").innerText = `${id} ã‚’ç‰¹åˆ¥ç™ºåˆ¸ã—ã¾ã—ãŸ`;
    }

    async function resetAll() {
      if (!confirm("å…¨ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      const snapshot = await db.collection("fastpasses").get();
      const batch = db.batch();
      snapshot.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
      document.getElementById("result").innerText = "âœ… å…¨ã¦å‰Šé™¤ã—ã¾ã—ãŸ";
    }
  </script>
</body>
</html>
