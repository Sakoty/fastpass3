<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>FastPass ç®¡ç†ç”»é¢</title>

<style>
body{
    font-family:sans-serif;
    background:#111;
    color:white;
    padding:20px;
}

.panel{
    background:#222;
    padding:20px;
    margin-bottom:20px;
    border-radius:10px;
}

input,button{
    padding:8px;
    margin:5px;
}

button{
    background:#00c3ff;
    border:none;
    color:white;
    cursor:pointer;
}

.row{
    display:flex;
    justify-content:space-between;
    padding:8px;
    border-bottom:1px solid #444;
}
</style>
</head>

<body>

<h1>ğŸ« FastPass ç®¡ç†ç”»é¢</h1>

<div class="panel">
<h2>æ–°ã—ã„ãƒ‘ã‚¹ä½œæˆ</h2>

<input id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
<input id="maxUses" type="number" placeholder="æœ€å¤§äººæ•°">
<input id="expire" type="datetime-local">

<button onclick="createPassword()">ä½œæˆ</button>
</div>

<div class="panel">
<h2>ç¾åœ¨ã®ãƒ‘ã‚¹ä¸€è¦§</h2>
<div id="list"></div>
</div>

<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";

import {
getFirestore,
collection,
addDoc,
getDocs,
updateDoc,
doc,
Timestamp
} from
"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  // â† è‡ªåˆ†ã®Firebaseè¨­å®š
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const listDiv = document.getElementById("list");


// =========================
// ãƒ‘ã‚¹ä½œæˆ
// =========================
window.createPassword = async () => {

    const password =
        document.getElementById("password").value;

    const maxUses =
        Number(document.getElementById("maxUses").value);

    const expire =
        new Date(document.getElementById("expire").value);

    await addDoc(collection(db,"passwords"),{
        password: password,
        enabled: true,
        maxUses: maxUses,
        usedCount: 0,
        expireAt: Timestamp.fromDate(expire),
        createdAt: Timestamp.now()
    });

    loadPasswords();
};


// =========================
// ä¸€è¦§èª­ã¿è¾¼ã¿
// =========================
async function loadPasswords(){

    listDiv.innerHTML = "";

    const snap = await getDocs(collection(db,"passwords"));

    snap.forEach(d=>{

        const data = d.data();

        const div = document.createElement("div");
        div.className="row";

        div.innerHTML = `
        <div>
            ${data.password}
            |
            ${data.enabled ? "æœ‰åŠ¹" : "ç„¡åŠ¹"}
            |
            ä½¿ç”¨ ${data.usedCount}/${data.maxUses}
        </div>

        <button onclick="toggle('${d.id}',${data.enabled})">
            ${data.enabled ? "åœæ­¢" : "æœ‰åŠ¹åŒ–"}
        </button>
        `;

        listDiv.appendChild(div);
    });
}


// =========================
// æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
// =========================
window.toggle = async(id,current)=>{

    await updateDoc(doc(db,"passwords",id),{
        enabled: !current
    });

    loadPasswords();
};


loadPasswords();

</script>

</body>
</html>
