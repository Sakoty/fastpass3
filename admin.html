<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ファストパス管理</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fffbe6;
      padding: 20px;
      margin: 0;
    }

    h1 {
      text-align: center;
      color: #cc9900;
      font-size: 1.5em;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
    }

    table {
      width: 100%;
      min-width: 700px;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 0.95em;
    }

    th {
      background-color: #f0c040;
    }

    .used {
      background-color: #ddd;
    }

    button {
      padding: 6px 10px;
      font-size: 0.9em;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    @media (max-width: 600px) {
      th, td {
        font-size: 0.85em;
        padding: 6px;
      }

      button {
        font-size: 0.85em;
        padding: 5px 8px;
      }
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDibHDpFtKBSCScK0QmB5xjKdBniS2EI1Y",
      authDomain: "fastpass-system.firebaseapp.com",
      projectId: "fastpass-system",
      storageBucket: "fastpass-system.appspot.com",
      messagingSenderId: "858745521872",
      appId: "1:858745521872:web:29289b673855097e1200d5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tbody = document.getElementById("list");

    const q = query(collection(db, "passes"), orderBy("createdAt", "asc"));
    onSnapshot(q, (snapshot) => {
      tbody.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const tr = document.createElement("tr");
        if (data.used) tr.classList.add("used");

        tr.innerHTML = `
          <td>${data.id}</td>
          <td>${data.name}</td>
          <td>${data.numPeople}</td>
          <td>${data.time}</td>
          <td>${data.used ? "使用済" : "未使用"}</td>
          <td>${data.special ? "特別" : "通常"}</td>
          <td>
            <button data-id="${docSnap.id}" class="toggle">
              ${data.used ? "未使用に戻す" : "呼び出し"}
            </button>
          </td>
          <td>
            <button data-id="${docSnap.id}" class="delete" style="background-color: red;">削除</button>
          </td>
        `;

        tr.querySelector(".toggle").addEventListener("click", async (e) => {
          const id = e.target.getAttribute("data-id");
          await updateDoc(doc(db, "passes", id), { used: !data.used });
        });

        tr.querySelector(".delete").addEventListener("click", async (e) => {
          const id = e.target.getAttribute("data-id");
          if (confirm("本当に削除しますか？")) {
            await deleteDoc(doc(db, "passes", id));
          }
        });

        tbody.appendChild(tr);
      });
    });
  </script>
</head>
<body>
  <h1>ファストパス管理画面</h1>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>名前</th>
          <th>人数</th>
          <th>時間</th>
          <th>状態</th>
          <th>種別</th>
          <th>操作</th>
          <th>削除</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>
  </div>
</body>
</html>
