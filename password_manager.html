<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>IDãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†</title>

<style>
body{
    font-family:sans-serif;
    background:#0f172a;
    color:white;
    padding:20px;
}

input,button{
    padding:8px;
    margin:5px;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}

td,th{
    border:1px solid #444;
    padding:8px;
    text-align:center;
}

.valid{
    background:#064e3b;
}

.expired{
    background:#7f1d1d;
}
</style>
</head>

<body>

<h2>ğŸ” IDç™ºè¡Œ</h2>

<input id="loginId" placeholder="ID">
<input id="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"><br>

<label>IDæœ‰åŠ¹æœŸé™</label>
<input type="datetime-local" id="idExpire">

<label>PWæœ‰åŠ¹æœŸé™</label>
<input type="datetime-local" id="pwExpire">

<br>
<button onclick="createUser()">IDä½œæˆ</button>

<hr>

<h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
<button onclick="loadUsers()">æ›´æ–°</button>

<table>
<thead>
<tr>
<th>ID</th>
<th>IDæœŸé™</th>
<th>PWæœŸé™</th>
<th>çŠ¶æ…‹</th>
<th>å‰Šé™¤</th>
</tr>
</thead>
<tbody id="userTable"></tbody>
</table>

<script>

// =====================
// ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜
// =====================
function getUsers(){
    return JSON.parse(localStorage.getItem("users") || "[]");
}

function saveUsers(users){
    localStorage.setItem("users", JSON.stringify(users));
}

// =====================
// æœŸé™ãƒã‚§ãƒƒã‚¯
// =====================
function isExpired(date){
    if(!date) return false;
    return new Date(date) < new Date();
}

// =====================
// IDä½œæˆ
// =====================
function createUser(){

    const id = loginId.value.trim();
    const pw = password.value;

    if(!id || !pw){
        alert("IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›");
        return;
    }

    const users = getUsers();

    if(users.find(u=>u.loginId===id)){
        alert("åŒã˜IDãŒå­˜åœ¨ã—ã¾ã™");
        return;
    }

    users.push({
        loginId:id,
        password:pw,
        idExpire:idExpire.value,
        passwordExpire:pwExpire.value,
        createdAt:new Date().toISOString()
    });

    saveUsers(users);

    alert("ä½œæˆå®Œäº†");

    loginId.value="";
    password.value="";

    loadUsers();
}

// =====================
// å‰Šé™¤
// =====================
function deleteUser(id){
    let users=getUsers();
    users=users.filter(u=>u.loginId!==id);
    saveUsers(users);
    loadUsers();
}

// =====================
// è¡¨ç¤º
// =====================
function loadUsers(){

    const users=getUsers();
    const table=document.getElementById("userTable");
    table.innerHTML="";

    users.forEach(u=>{

        const expired =
            isExpired(u.idExpire) ||
            isExpired(u.passwordExpire);

        const tr=document.createElement("tr");
        tr.className=expired ? "expired":"valid";

        tr.innerHTML=`
            <td>${u.loginId}</td>
            <td>${u.idExpire || "-"}</td>
            <td>${u.passwordExpire || "-"}</td>
            <td>${expired ? "æœŸé™åˆ‡ã‚Œ":"æœ‰åŠ¹"}</td>
            <td>
                <button onclick="deleteUser('${u.loginId}')">
                å‰Šé™¤
                </button>
            </td>
        `;

        table.appendChild(tr);
    });
}

loadUsers();

</script>

</body>
</html>
