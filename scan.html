<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>整理券 使用済みチェック</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>整理券 使用済みチェック</h1>
  <div id="status">読み込み中...</div>

  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyDibHDpFtKBSCScK0QmB5xjKdBniS2EI1Y",
  authDomain: "fastpass-system.firebaseapp.com",
  projectId: "fastpass-system",
  storageBucket: "fastpass-system.firebasestorage.app",
  messagingSenderId: "858745521872",
  appId: "1:858745521872:web:29289b673855097e1200d5",
  measurementId: "G-SLPKMCNY53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // URLパラメータからID取得
    const urlParams = new URLSearchParams(window.location.search);
    const ticketId = urlParams.get('id');
    const statusDiv = document.getElementById('status');

    async function checkAndMarkUsed() {
      if (!ticketId) {
        statusDiv.textContent = '整理券IDが指定されていません。';
        return;
      }

      const docRef = db.collection('tickets').doc(ticketId);
      const docSnap = await docRef.get();

      if (!docSnap.exists) {
        statusDiv.textContent = '整理券が見つかりません。';
        return;
      }

      const data = docSnap.data();

      if (data.used) {
        statusDiv.textContent = `整理券「${ticketId}」はすでに使用済みです。`;
        return;
      }

      // 使用済みに更新
      await docRef.update({ used: true });
      statusDiv.textContent = `整理券「${ticketId}」を使用済みにしました。ありがとうございました！`;
    }

    checkAndMarkUsed();
  </script>
</body>
</html>
